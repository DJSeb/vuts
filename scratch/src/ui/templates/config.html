{% extends "base.html" %}

{% block title %}Configuration - VUTS{% endblock %}

{% block content %}
<div class="page-header">
    <h2>‚öôÔ∏è Configuration & Management</h2>
    <p class="subtitle">Manage system settings and data sources</p>
</div>

<div class="config-container">
    <section class="config-section">
        <h3>üìä Current Configuration</h3>
        {% if config %}
        <div class="config-display">
            <div class="config-item">
                <label>Topics to Monitor:</label>
                <div class="config-value">
                    {% for topic in config.topics %}
                    <span class="badge neutral">{{ topic }}</span>
                    {% endfor %}
                </div>
            </div>

            <div class="config-item">
                <label>News Sources:</label>
                <div class="config-value">
                    {% for source in config.sources %}
                    <span class="badge neutral">{{ source }}</span>
                    {% endfor %}
                </div>
            </div>

            <div class="config-item">
                <label>Max Article Age:</label>
                <div class="config-value">{{ config.max_age_days }} days</div>
            </div>

            <div class="config-item">
                <label>Fetch Full Content:</label>
                <div class="config-value">{{ "Yes" if config.fetch_full_content else "No" }}</div>
            </div>

            {% if config.fetch_full_content %}
            <div class="config-item">
                <label>Full Content Top N:</label>
                <div class="config-value">{{ config.fetch_full_top_n }} articles</div>
            </div>
            {% endif %}

            <div class="config-item">
                <label>Content Extractor:</label>
                <div class="config-value">{{ config.content_extractor }}</div>
            </div>

            <div class="config-item">
                <label>Max Content Length:</label>
                <div class="config-value">{{ config.max_content_chars }} characters</div>
            </div>
        </div>
        {% else %}
        <div class="alert alert-info">
            <p>No configuration file found. Using default settings.</p>
            <p>Create a configuration file at <code>scratch/config.json</code> or use <code>scratch/example_data/copilot-gpt5-cfg.json</code> as a template.</p>
        </div>
        {% endif %}
    </section>

    <section class="config-section">
        <h3>üìÅ Data Management</h3>
        <div class="config-display">
            <div class="config-item">
                <label>Data Directory:</label>
                <div class="config-value"><code>{{ data_dir }}</code></div>
            </div>

            <div class="config-item">
                <label>Available Topics:</label>
                <div class="config-value">
                    {% if available_topics %}
                    {% for topic in available_topics %}
                    <span class="badge neutral">{{ topic }}</span>
                    {% endfor %}
                    {% else %}
                    <span class="text-muted">No topics analyzed yet</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <section class="config-section">
        <h3>üîß Workflow Commands</h3>
        <div class="workflow-commands">
            <div class="command-card">
                <h4>1. Fetch News Articles</h4>
                <pre><code>cd scratch
python src/fetching/financial_news_collector_async.py \
    example_data/copilot-gpt5-cfg.json output</code></pre>
                <p class="command-description">Fetches news articles from configured sources for specified topics.</p>
            </div>

            <div class="command-card">
                <h4>2. Fetch Market Data (Optional)</h4>
                <pre><code>cd scratch
python src/market/data_fetcher.py TSLA MSFT NVIDIA AMD \
    --output-dir output/market_data</code></pre>
                <p class="command-description">Fetches historical market data to provide context for sentiment analysis.</p>
            </div>

            <div class="command-card">
                <h4>3. Analyze Sentiment</h4>
                <pre><code>cd scratch
python src/llm/sentiment_analyzer.py \
    --data-dir output \
    --max-articles 10 \
    --market-data-dir output/market_data</code></pre>
                <p class="command-description">Analyzes sentiment of collected articles using LLM.</p>
                <div class="alert alert-warning">
                    ‚ö†Ô∏è Requires <code>OPENAI_API_KEY</code> environment variable
                </div>
            </div>

            <div class="command-card">
                <h4>Quick Demo (No API Keys)</h4>
                <pre><code>cd scratch
python demo_workflow.py</code></pre>
                <p class="command-description">Runs a complete demo with mock data - no API keys required.</p>
            </div>
        </div>
    </section>

    <section class="config-section">
        <h3>üîë API Configuration</h3>
        <div class="api-config">
            <div class="alert alert-info">
                <h4>Required API Keys</h4>
                <p>Set these environment variables before running the analysis:</p>
                <ul>
                    <li><strong>OPENAI_API_KEY</strong> - Required for sentiment analysis (OpenAI GPT models)</li>
                </ul>
                
                <h4>Optional API Keys</h4>
                <ul>
                    <li><strong>NEWSAPI_KEY</strong> - For NewsAPI.org news fetching</li>
                    <li><strong>BING_NEWS_KEY</strong> - For Bing News API</li>
                    <li><strong>FINNHUB_KEY</strong> - For Finnhub financial news</li>
                </ul>
                
                <p class="text-muted">Note: Some news sources (like Google News RSS) don't require API keys.</p>
            </div>
        </div>
    </section>

    <section class="config-section">
        <h3>üìù Configuration File Format</h3>
        <div class="config-template">
            <p>Create a JSON configuration file with the following structure:</p>
            <pre><code>{
  "topics": ["TSLA", "MSFT", "NVIDIA", "AMD"],
  "sources": ["googlenews_rss", "bingnews", "finnhub"],
  "max_age_days": 14,
  "fetch_full_content": true,
  "fetch_full_top_n": 5,
  "content_extractor": "readability",
  "max_content_chars": 6000
}</code></pre>
        </div>
    </section>
</div>
{% endblock %}
